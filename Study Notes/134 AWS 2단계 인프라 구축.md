# AWS 2단계 인프라 구축: Nginx 리버스 프록시로 Express 앞단 구성

### 📅 날짜:

> 2025.01.14 (수)
> 

### 📘 오늘 공부한 주제:

> **Nginx를 웹 서버로 추가하여 Express 서버를 보호하고 구조를 개선하기**
> 
> - Nginx 리버스 프록시 개념 이해
> - 80 포트 기반 요청 처리
> - Express(3000 포트) 내부 서버로 숨기기
> - EC2 단일 서버 구조에서의 역할 분리

---

## 📝 핵심 개념 요약

- **Nginx는 클라이언트의 모든 요청을 먼저 받는 웹 서버**
- 외부 요청은 **80 포트**, 내부 애플리케이션은 **3000 포트**
- Express 서버는 직접 노출되지 않음
- URL에서 포트 번호 제거 → 사용자 경험 개선
- 웹 서버(Nginx) + 애플리케이션 서버(Express) 역할 분리 시작

## 📊 핵심 요약 표

| 구분 | 적용 전 | 적용 후 |
| --- | --- | --- |
| 클라이언트 요청 | EC2:3000 직접 접근 | EC2:80 → Nginx |
| 포트 노출 | 3000번 노출 | 내부 포트 숨김 |
| URL 형태 | `http://ip:3000` | `http://ip` |
| 서버 역할 | Express 단독 | Nginx + Express |
| 보안성 | 낮음 | 상대적으로 개선 |

### 💻 실습 내용 정리

### 1️⃣ Nginx 개념 이해

**리버스 프록시 구조**

```bash
Client → Nginx (80) → Express (3000)
```

- 클라이언트는 Express의 존재를 모름
- Nginx가 모든 요청의 입구 역할 수행

---

### 2️⃣ Nginx 설치 및 실행

```bash
sudo yum install nginx
sudo systemctl start nginx
```

- 퍼블릭 IP 접속 시 **“Welcome to nginx!”** 페이지 확인
- Nginx 정상 설치 확인

---

### 3️⃣ EC2 인바운드 규칙 수정

- 기존: TCP 3000
- 변경: **HTTP 80**
- 이제 외부 트래픽은 Nginx만 접근 가능

---

### 4️⃣ Nginx 설정 파일 작성

- 기본 `nginx.conf` 수정 ❌
- **프로젝트 전용 설정 파일 생성 ⭕**

```bash
sudo vim /etc/nginx/conf.d/my_express_app.conf
```

```
server {
listen80;

server_name [EC2_퍼블릭_IP];

location / {
proxy_pass http://127.0.0.1:3000;
proxy_set_header Host$host;
proxy_set_header X-Real-IP$remote_addr;
proxy_set_header X-Forwarded-For$proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto$scheme;
    }
}
```

---

### 5️⃣ proxy_pass 동작 이해

- `127.0.0.1` → 같은 서버 내부 주소
- 외부에서 3000 포트 접근 차단
- 보안 + 구조적 안정성 확보

---

### 6️⃣ 설정 검증 및 반영

```bash
sudo nginx -t
sudo systemctl reload nginx
```

- reload 사용 → 서비스 중단 없음

---

### 7️⃣ 상태 확인

```bash
sudo systemctl status nginx
sudo netstat -tlnp | grep :80
```

- 브라우저에서 `http://[퍼블릭_IP]` 접속 → Express API 정상 응답 확인

---

### 8️⃣ 부팅 시 자동 실행 설정

```bash
sudo systemctlenable nginx
```

- EC2 재부팅 후에도 Nginx 자동 실행

### ❗ 헷갈렸던 점 / 문제 해결:

- **server_name**
    - 도메인이 없을 경우 퍼블릭 IP 사용 가능
- **reload vs restart**
    - 설정 변경 시 `reload`가 안전
- **3000 포트 접근**
    - 보안 그룹에서 제거해도 내부 통신에는 문제 없음
- **default.conf 수정 여부**
    - 기존 설정 유지 + 신규 파일 생성이 관리에 유리

### 💡 느낀 점 / 배운 점:

- “웹 서버”의 역할이 명확히 느껴짐
- Express는 이제 **뒤에서 일만 하는 구조**
- URL이 깔끔해지는 것만으로도 서비스 느낌이 달라짐
- 이후 HTTPS, 도메인, 로드밸런서 확장이 자연스럽게 이어질 구조
- 인프라가 **점점 레이어 구조로 쌓이는 감각**을 얻음

### 🏷️ 키워드 (태그):

`Nginx` `ReverseProxy` `웹서버` `Express` `EC2` `AWS` `포트포워딩` `서버구조` `인프라기초`

| 날짜 | 주제 | 핵심 요약 | 실습 내용 | 문제 해결 / 느낀 점 | 키워드 태그 | 복습 필요 |
| --- | --- | --- | --- | --- | --- | --- |
| 2025-01-14 | Nginx 리버스 프록시 | 80포트로 요청 통합, Express 숨김 | Nginx 설치, proxy 설정, 자동 실행 | 웹 서버 역할 체감 | `Nginx` `ReverseProxy` `AWS` | ✅ |
